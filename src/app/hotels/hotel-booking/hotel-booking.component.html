<div class="container my-4">
    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    }
  
    @if (errorMessage) {
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
      </div>
    }
  
    @if (hotel) {
      <!-- Hotel Details Section -->
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="card-title">{{ hotel.name }}</h2>
          <div class="hotel-details">
            <div class="row">
              <div class="col-md-8">
                <p class="mb-2">
                  <i class="fas fa-map-marker-alt me-2"></i>
                  {{ hotel.location }}
                </p>
                <div class="d-flex align-items-center mb-3">
                  <span class="badge bg-success me-2">â˜… {{ averageRating | number:'1.1-1' }}</span>
                  <span class="text-muted">{{ hotel.reviews?.length || 0 }} reviews</span>
                </div>
                <p class="hotel-description">{{ hotel.description }}</p>
              </div>
              <div class="col-md-4 text-end">
                <h3 class="text-primary mb-0">
                  {{ hotel.pricePerNight | currency:'INR' }}
                  <small class="text-muted">/night</small>
                </h3>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- Booking Form Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h3 class="card-title mb-4">Book Your Stay</h3>
                <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Check In</label>
                            <input type="date" class="form-control" formControlName="checkIn"
                                [class.is-invalid]="bookingForm.get('checkIn')?.invalid && 
                                                  bookingForm.get('checkIn')?.touched">
                            @if (bookingForm.get('checkIn')?.invalid && bookingForm.get('checkIn')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('checkIn') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Check Out</label>
                            <input type="date" class="form-control" formControlName="checkOut"
                                [class.is-invalid]="bookingForm.get('checkOut')?.invalid && 
                                                  bookingForm.get('checkOut')?.touched">
                            @if (bookingForm.get('checkOut')?.invalid && bookingForm.get('checkOut')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('checkOut') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Guests/Rooms</label>
                            <input type="number" class="form-control" formControlName="guestsRooms" min="1"
                                [class.is-invalid]="bookingForm.get('guestsRooms')?.invalid && 
                                                  bookingForm.get('guestsRooms')?.touched">
                            @if (bookingForm.get('guestsRooms')?.invalid && bookingForm.get('guestsRooms')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('guestsRooms') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" formControlName="firstName"
                                [class.is-invalid]="bookingForm.get('firstName')?.invalid && 
                                                  bookingForm.get('firstName')?.touched">
                            @if (bookingForm.get('firstName')?.invalid && bookingForm.get('firstName')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('firstName') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" formControlName="lastName"
                                [class.is-invalid]="bookingForm.get('lastName')?.invalid && 
                                                  bookingForm.get('lastName')?.touched">
                            @if (bookingForm.get('lastName')?.invalid && bookingForm.get('lastName')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('lastName') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" formControlName="email"
                                [class.is-invalid]="bookingForm.get('email')?.invalid && 
                                                  bookingForm.get('email')?.touched">
                            @if (bookingForm.get('email')?.invalid && bookingForm.get('email')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('email') }}
                                </div>
                            }
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" formControlName="phone"
                                [class.is-invalid]="bookingForm.get('phone')?.invalid && 
                                                  bookingForm.get('phone')?.touched">
                            @if (bookingForm.get('phone')?.invalid && bookingForm.get('phone')?.touched) {
                                <div class="invalid-feedback">
                                    {{ getErrorMessage('phone') }}
                                </div>
                            }
                        </div>

                        <div class="col-12">
                            <label class="form-label">Special Requests</label>
                            <textarea class="form-control" rows="3" formControlName="specialRequests"></textarea>
                        </div>

                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary px-5"
                                    [disabled]="bookingForm.invalid || isLoading">
                                @if (isLoading) {
                                    <span class="spinner-border spinner-border-sm me-2"></span>
                                    Processing...
                                } @else {
                                    Confirm Booking
                                }
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- Confirmation Popup -->
<!-- <div *ngIf="showConfirmationPopup" class="popup-overlay">
    <div class="popup">
      <h3>Confirm Booking</h3>
      <p><strong>Hotel:</strong> {{ bookingDetails.hotelName }}</p>
      <p><strong>Email:</strong> {{ bookingDetails.email }}</p>
      <p><strong>Check-in Date:</strong> {{ bookingDetails.checkIn }}</p>
      <p><strong>Check-out Date:</strong> {{ bookingDetails.checkOut }}</p>
      <p><strong>Guests/Rooms:</strong> {{ bookingDetails.guestsRooms }}</p>
      <p><strong>Phone:</strong> {{ bookingDetails.phone }}</p>
      <p><strong>Special Requests:</strong> {{ bookingDetails.specialRequests }}</p>
      <p><strong>Total Price:</strong> {{ bookingDetails.totalPrice | currency:'INR' }}</p>
      <button class="btn btn-success me-2" (click)="confirmBooking()">Confirm</button>
      <button class="btn btn-secondary" (click)="closePopup()">Cancel</button>
    </div>
  </div> -->
  <!-- <div *ngIf="showConfirmationPopup" class="popup-overlay">
    <div class="popup">
      <h3>Confirm Booking</h3>
      <p><strong>Hotel:</strong> {{ bookingDetails.hotelName }}</p>
      <p><strong>Email:</strong> {{ bookingDetails.email }}</p>
      <p><strong>Check-in Date:</strong> {{ bookingDetails.checkIn }}</p>
      <p><strong>Check-out Date:</strong> {{ bookingDetails.checkOut }}</p>
      <p><strong>Guests/Rooms:</strong> {{ bookingDetails.guestsRooms }}</p>
      <p><strong>Total Price:</strong> {{ bookingDetails.totalPrice | currency:'INR' }}</p>
      <button *ngIf="!isAvailabilityConfirmed" class="btn btn-primary" (click)="confirmAvailability()">Confirm</button>
      <button *ngIf="isAvailabilityConfirmed" class="btn btn-success" (click)="confirmBooking()">Pay Now</button>
      <button class="btn btn-secondary" (click)="closePopup()">Cancel</button>
    </div>
  </div> -->
  <div *ngIf="showConfirmationPopup" class="popup-overlay">
    <div class="popup">
      <h3>Confirm Booking</h3>
      <p><strong>Hotel:</strong> {{ bookingDetails.hotelName }}</p>
      <p><strong>Email:</strong> {{ bookingDetails.email }}</p>
      <p><strong>Check-in Date:</strong> {{ bookingDetails.checkIn }}</p>
      <p><strong>Check-out Date:</strong> {{ bookingDetails.checkOut }}</p>
      <p><strong>Guests/Rooms:</strong> {{ bookingDetails.guestsRooms }}</p>
      <p><strong>Phone:</strong> {{ bookingDetails.phone }}</p>
      <p><strong>Special Requests:</strong> {{ bookingDetails.specialRequests }}</p>
      <p><strong>Total Price:</strong> {{ bookingDetails.totalPrice | currency:'INR' }}</p>
  
      <!-- Confirm Button -->
      <button class="btn btn-success me-2" (click)="confirmBooking()">Confirm</button>
  
      <!-- Pay Now Button -->
      <a *ngIf="bookingDetails.sessionUrl" [href]="bookingDetails.sessionUrl" target="_blank" class="btn btn-primary">
        Pay Now
      </a>
  
      <!-- Cancel Button -->
      <button class="btn btn-secondary" (click)="closePopup()">Cancel</button>
    </div>
  </div>
        <!-- Reviews Section -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title mb-4">Guest Reviews</h3>
                <app-review-by-hotel [hotelId]="hotelId"></app-review-by-hotel>
            </div>
        </div>
    } @else {
        <div class="alert alert-info">
            Loading hotel details...
        </div>
    }
</div>